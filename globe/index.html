<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Interactive Earth – Zones & Cities</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
  body{background:#000;color:#fff;overflow:hidden}
  #container{position:absolute;top:0;left:0;width:100%;height:100%}
  #ui{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);padding:8px 14px;border-radius:20px;font-size:14px;z-index:10}
  #clock{position:absolute;top:20px;left:20px;background:rgba(0,0,0,.6);padding:8px 12px;border-radius:8px;font-size:18px;font-variant-numeric:tabular-nums}
  #tooltip{position:absolute;background:rgba(0,0,0,.8);padding:4px 8px;border-radius:4px;font-size:12px;pointer-events:none;opacity:0;transition:opacity .2s}
</style>
</head>
<body>
<div id="container"></div>
<div id="ui">Drag to rotate • Scroll to zoom • Hover for name • Click to add/remove</div>
<div id="clock">--:--:--</div>
<div id="tooltip"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
// ---------- THREE ----------
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(45,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.4));
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,3,5);
scene.add(light);

const radius=5;
const earth=new THREE.Mesh(
  new THREE.SphereGeometry(radius,64,64),
  new THREE.MeshPhongMaterial({
    map:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-blue-marble.jpg'),
    bumpMap:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png'),
    bumpScale:0.05
  })
);
scene.add(earth);

const clouds=new THREE.Mesh(
  new THREE.SphereGeometry(radius+.03,64,64),
  new THREE.MeshPhongMaterial({
    map:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-clouds.png'),
    transparent:true,opacity:.4
  })
);
scene.add(clouds);

// ---------- DATA ----------
const cities=[
  {name:'New York',lat:40.7,lon:-74,offset:-4},
  {name:'London',lat:51.5,lon:-0.1,offset:1},
  {name:'Tokyo',lat:35.7,lon:139.6,offset:9},
  {name:'Sydney',lat:-33.9,lon:151.2,offset:10},
  {name:'Rio',lat:-22.9,lon:-43.2,offset:-3},
  {name:'Cairo',lat:30,lon:31.2,offset:2},
  {name:'Moscow',lat:55.8,lon:37.6,offset:3},
  {name:'Beijing',lat:39.9,lon:116.4,offset:8},
  {name:'Cape Town',lat:-33.9,lon:18.4,offset:2},
  {name:'Los Angeles',lat:34.1,lon:-118.2,offset:-7},
  {name:'Paris',lat:48.9,lon:2.3,offset:2},
  {name:'Dubai',lat:25.2,lon:55.3,offset:4},
  {name:'Mumbai',lat:19.1,lon:72.9,offset:5.5},
  {name:'Singapore',lat:1.3,lon:103.8,offset:8},
  {name:'Berlin',lat:52.5,lon:13.4,offset:2},
  {name:'Seoul',lat:37.6,lon:127,offset:9},
  {name:'Mexico City',lat:19.4,lon:-99.1,offset:-6},
  {name:'Nairobi',lat:-1.3,lon:36.8,offset:3},
  {name:'Toronto',lat:43.7,lon:-79.4,offset:-4},
  {name:'Bangkok',lat:13.8,lon:100.5,offset:7}
];

// ---------- MARKERS ----------
const markerGroup=new THREE.Group();scene.add(markerGroup);
const latLonToVector3=(lat,lon,r)=>new THREE.Vector3(
  -r*Math.cos(lat*Math.PI/180)*Math.cos(lon*Math.PI/180),
  r*Math.sin(lat*Math.PI/180),
  r*Math.cos(lat*Math.PI/180)*Math.sin(lon*Math.PI/180)
);

const markerMat=new THREE.SpriteMaterial({
  map:new THREE.TextureLoader().load('data:image/svg+xml;base64,'+btoa('<svg width="12" height="12" xmlns="http://www.w3.org/2000/svg"><circle cx="6" cy="6" r="5" fill="#00d2ff"/></svg>')),
  transparent:true,opacity:.9,depthTest:false
});

cities.forEach(c=>{
  const sp=new THREE.Sprite(markerMat.clone());
  sp.position.copy(latLonToVector3(c.lat,c.lon,radius+.08));
  sp.scale.set(.2,.2,1);
  sp.userData=c;
  markerGroup.add(sp);
});

// ---------- UI ----------
const countSpan=document.getElementById('ui').querySelector('span');
const clock=document.getElementById('clock');
const tooltip=document.getElementById('tooltip');

let visibleMarkers=new Set(cities.map((_,i)=>i));
function updateCount(){
  countSpan.textContent=visibleMarkers.size;
}
updateCount();

// ---------- CONTROLS ----------
let rot={x:0,y:0},tgt={x:0,y:0},drag=false,last={x:0,y:0};
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();

renderer.domElement.addEventListener('mousedown',e=>{
  drag=true;
  last={x:e.clientX,y:e.clientY};
});

renderer.domElement.addEventListener('mousemove',e=>{
  if(drag){
    tgt.y+=(e.clientX-last.x)*0.005;
    tgt.x-=(e.clientY-last.y)*0.005;
    tgt.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,tgt.x));
    last={x:e.clientX,y:e.clientY};
  }
  // Tooltip
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const inter=raycaster.intersectObjects(markerGroup.children);
  if(inter.length){
    const d=inter[0].object.userData;
    tooltip.style.left=e.clientX+10+'px';
    tooltip.style.top=e.clientY-20+'px';
    tooltip.textContent=d.name;
    tooltip.style.opacity=1;
  }else tooltip.style.opacity=0;
});

renderer.domElement.addEventListener('mouseup',()=>drag=false);
renderer.domElement.addEventListener('mouseleave',()=>tooltip.style.opacity=0);

// Click to toggle marker visibility
renderer.domElement.addEventListener('click',e=>{
  if(drag) return;
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const inter=raycaster.intersectObjects(markerGroup.children);
  if(inter.length){
    const idx=markerGroup.children.indexOf(inter[0].object);
    inter[0].object.visible=!inter[0].object.visible;
    if(inter[0].object.visible) visibleMarkers.add(idx);
    else visibleMarkers.delete(idx);
    updateCount();
  }
});

// Zoom
renderer.domElement.addEventListener('wheel',e=>{
  camera.position.z+=e.deltaY*0.01;
  camera.position.z=Math.max(8,Math.min(20,camera.position.z));
});

// Live clock
setInterval(()=>clock.textContent=new Date().toLocaleTimeString(),1000);

camera.position.z=12;
function animate(){
  requestAnimationFrame(animate);
  rot.x+=(tgt.x-rot.x)*.05;
  rot.y+=(tgt.y-rot.y)*.05;
  earth.rotation.x=clouds.rotation.x=rot.x;
  earth.rotation.y=clouds.rotation.y=rot.y;
  markerGroup.rotation.x=markerGroup.rotation.y=rot.x;
  markerGroup.rotation.y=rot.y;
  clouds.rotation.y+=0.0002;
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
