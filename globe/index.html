<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Interactive Earth ‚Äì Zones & Cities</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
  body{background:#000;color:#fff;overflow:hidden}
  #container{position:absolute;top:0;left:0;width:100%;height:100%}
  #ui{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);padding:8px 14px;border-radius:20px;font-size:14px}
  #clock{position:absolute;top:20px;left:20px;background:rgba(0,0,0,.6);padding:8px 12px;border-radius:8px;font-size:18px;font-variant-numeric:tabular-nums}
  button{cursor:pointer;border:none;background:rgba(255,255,255,.15);color:#fff;backdrop-filter:blur(4px)}
  #tzBtn,#cityBtn{position:absolute;top:20px;width:48px;height:48px;border-radius:50%;font-size:24px;transition:.3s}
  #tzBtn{right:20px}
  #cityBtn{right:80px}
  button:hover{background:rgba(255,255,255,.25)}
  .sheet{position:fixed;bottom:0;left:0;width:100%;max-height:0;background:#111;overflow:hidden;transition:max-height .3s;border-top:1px solid #333;border-radius:20px 20px 0 0;z-index:30}
  .sheet.open{max-height:60vh}
  .sheetHeader{padding:14px 18px;border-bottom:1px solid #333;display:flex;align-items:center}
  .sheetHeader span{flex:1;font-weight:600}
  .closeSheet{background:none;color:#fff;font-size:20px}
  .sheetSearch{background:#222;border:none;color:#fff;width:100%;padding:10px 18px;font-size:15px;outline:none}
  .sheetList{max-height:calc(60vh - 110px);overflow-y:auto}
  .sheetRow{padding:12px 18px;display:flex;align-items:center;font-size:15px}
  .sheetRow:hover{background:#222}
  .sheetRow input{margin-right:12px}
  #tooltip{position:absolute;background:rgba(0,0,0,.8);padding:4px 8px;border-radius:4px;font-size:12px;pointer-events:none;opacity:0;transition:opacity .2s}
</style>
</head>
<body>
<div id="container"></div>
<div id="ui">Drag to rotate ‚Ä¢ Scroll to zoom ‚Ä¢ Visible: <span id="count">0</span></div>
<div id="clock">--:--:--</div>

<button id="tzBtn" title="Time zones">üåç</button>
<button id="cityBtn" title="Cities">üèôÔ∏è</button>

<!-- Time-zone sheet -->
<div id="tzSheet" class="sheet">
  <div class="sheetHeader">
    <span>Time Zones</span>
    <button class="closeSheet" id="closeTzSheet">‚úï</button>
  </div>
  <input class="sheetSearch" id="tzSearch" placeholder="Search zone‚Ä¶"/>
  <div class="sheetList" id="tzList"></div>
</div>

<!-- Cities sheet -->
<div id="citySheet" class="sheet">
  <div class="sheetHeader">
    <span>Cities</span>
    <button class="closeSheet" id="closeCitySheet">‚úï</button>
  </div>
  <input class="sheetSearch" id="citySearch" placeholder="Search city‚Ä¶"/>
  <div class="sheetList" id="cityList"></div>
</div>

<div id="tooltip"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
// ---------- THREE ----------
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(45,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// lights
scene.add(new THREE.AmbientLight(0xffffff,.4));
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,3,5);
scene.add(light);

// Earth
const radius=5;
const earth=new THREE.Mesh(
  new THREE.SphereGeometry(radius,64,64),
  new THREE.MeshPhongMaterial({
    map:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-blue-marble.jpg'),
    bumpMap:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png'),
    bumpScale:0.05
  })
);
scene.add(earth);

// Clouds
const clouds=new THREE.Mesh(
  new THREE.SphereGeometry(radius+.03,64,64),
  new THREE.MeshPhongMaterial({
    map:new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-globe/example/img/earth-clouds.png'),
    transparent:true,opacity:.4
  })
);
scene.add(clouds);

// ---------- DATA ----------
// Time zones every 15¬∞
const zones=[];
for(let lon=-180;lon<180;lon+=15)zones.push({name:`UTC${lon?lon/15:''}`,lat:0,lon});

// Major cities
const cities=[
  {name:'New York',lat:40.7,lon:-74,offset:-4},
  {name:'London',lat:51.5,lon:-0.1,offset:1},
  {name:'Tokyo',lat:35.7,lon:139.6,offset:9},
  {name:'Sydney',lat:-33.9,lon:151.2,offset:10},
  {name:'Rio',lat:-22.9,lon:-43.2,offset:-3},
  {name:'Cairo',lat:30,lon:31.2,offset:2},
  {name:'Moscow',lat:55.8,lon:37.6,offset:3},
  {name:'Beijing',lat:39.9,lon:116.4,offset:8},
  {name:'Cape Town',lat:-33.9,lon:18.4,offset:2},
  {name:'Los Angeles',lat:34.1,lon:-118.2,offset:-7},
  {name:'Paris',lat:48.9,lon:2.3,offset:2},
  {name:'Dubai',lat:25.2,lon:55.3,offset:4},
  {name:'Mumbai',lat:19.1,lon:72.9,offset:5.5},
  {name:'Singapore',lat:1.3,lon:103.8,offset:8},
  {name:'Berlin',lat:52.5,lon:13.4,offset:2},
  {name:'Seoul',lat:37.6,lon:127,offset:9},
  {name:'Mexico City',lat:19.4,lon:-99.1,offset:-6},
  {name:'Nairobi',lat:-1.3,lon:36.8,offset:3},
  {name:'Toronto',lat:43.7,lon:-79.4,offset:-4},
  {name:'Bangkok',lat:13.8,lon:100.5,offset:7}
];

// ---------- MARKERS ----------
const markerGroup=new THREE.Group();scene.add(markerGroup); // zones
const cityGroup=new THREE.Group();scene.add(cityGroup);     // cities

const latLonToVector3=(lat,lon,r)=>new THREE.Vector3(
  -r*Math.cos(lat*Math.PI/180)*Math.cos(lon*Math.PI/180),
  r*Math.sin(lat*Math.PI/180),
  r*Math.cos(lat*Math.PI/180)*Math.sin(lon*Math.PI/180)
);

// zone markers
const zoneMat=new THREE.SpriteMaterial({
  map:new THREE.TextureLoader().load('data:image/svg+xml;base64,'+btoa('<svg width="8" height="8" xmlns="http://www.w3.org/2000/svg"><circle cx="4" cy="4" r="3" fill="#fff" fill-opacity=".45"/></svg>')),
  transparent:true,opacity:.6,depthTest:false
});
zones.forEach(z=>{
  const sp=new THREE.Sprite(zoneMat.clone());
  sp.position.copy(latLonToVector3(z.lat,z.lon,radius+.05));
  sp.scale.set(.12,.12,1);
  sp.userData=z;
  markerGroup.add(sp);
});

// city markers
const cityMat=new THREE.SpriteMaterial({
  map:new THREE.TextureLoader().load('data:image/svg+xml;base64,'+btoa('<svg width="12" height="12" xmlns="http://www.w3.org/2000/svg"><circle cx="6" cy="6" r="5" fill="#00d2ff"/></svg>')),
  transparent:true,opacity:.9,depthTest:false
});
cities.forEach(c=>{
  const sp=new THREE.Sprite(cityMat.clone());
  sp.position.copy(latLonToVector3(c.lat,c.lon,radius+.08));
  sp.scale.set(.2,.2,1);
  sp.userData=c;
  cityGroup.add(sp);
});

// ---------- UI ----------
let selectedZones=new Set();zones.forEach((_,i)=>selectedZones.add(i));
let selectedCities=new Set();cities.forEach((_,i)=>selectedCities.add(i));
const countSpan=document.getElementById('count');
const clock=document.getElementById('clock');
const tooltip=document.getElementById('tooltip');

// sheets
const tzSheet=document.getElementById('tzSheet');
const citySheet=document.getElementById('citySheet');
const tzSearch=document.getElementById('tzSearch');
const citySearch=document.getElementById('citySearch');
const tzList=document.getElementById('tzList');
const cityList=document.getElementById('cityList');

function buildZoneList(filter=''){
  tzList.innerHTML='';
  zones.forEach((z,i)=>{
    if(!z.name.toLowerCase().includes(filter.toLowerCase()))return;
    const row=document.createElement('label');row.className='sheetRow';
    const cb=document.createElement('input');cb.type='checkbox';cb.checked=selectedZones.has(i);
    cb.addEventListener('change',()=>toggleZone(i));
    row.appendChild(cb);row.append(' '+z.name);
    row.addEventListener('click',e=>{if(e.target!==cb){cb.checked=!cb.checked;toggleZone(i);}});
    tzList.appendChild(row);
  });
}
function buildCityList(filter=''){
  cityList.innerHTML='';
  cities.forEach((c,i)=>{
    if(!c.name.toLowerCase().includes(filter.toLowerCase()))return;
    const row=document.createElement('label');row.className='sheetRow';
    const cb=document.createElement('input');cb.type='checkbox';cb.checked=selectedCities.has(i);
    cb.addEventListener('change',()=>toggleCity(i));
    row.appendChild(cb);row.append(' '+c.name);
    row.addEventListener('click',e=>{if(e.target!==cb){cb.checked=!cb.checked;toggleCity(i);}});
    cityList.appendChild(row);
  });
}
function toggleZone(i){
  selectedZones.has(i)?selectedZones.delete(i):selectedZones.add(i);
  markerGroup.children[i].visible=selectedZones.has(i);
  buildZoneList(tzSearch.value);updateCount();
}
function toggleCity(i){
  selectedCities.has(i)?selectedCities.delete(i):selectedCities.add(i);
  cityGroup.children[i].visible=selectedCities.has(i);
  buildCityList(citySearch.value);updateCount();
}
function updateCount(){
  countSpan.textContent=selectedZones.size+selectedCities.size;
}

buildZoneList();buildCityList();updateCount();

document.getElementById('tzBtn').addEventListener('click',()=>{tzSheet.classList.add('open');buildZoneList();});
document.getElementById('cityBtn').addEventListener('click',()=>{citySheet.classList.add('open');buildCityList();});
document.getElementById('closeTzSheet').addEventListener('click',()=>tzSheet.classList.remove('open'));
document.getElementById('closeCitySheet').addEventListener('click',()=>citySheet.classList.remove('open'));
tzSearch.addEventListener('input',e=>buildZoneList(e.target.value));
citySearch.addEventListener('input',e=>buildCityList(e.target.value));

// live clock
setInterval(()=>{
  clock.textContent=new Date().toLocaleTimeString();
},1000);

// ---------- CONTROLS ----------
let rot={x:0,y:0},tgt={x:0,y:0},drag=false,last={x:0,y:0};
renderer.domElement.addEventListener('mousedown',e=>{drag=true;last={x:e.clientX,y:e.clientY}});
document.addEventListener('mousemove',e=>{
  if(!drag)return;
  tgt.y+=(e.clientX-last.x)*0.005;
  tgt.x-=(e.clientY-last.y)*0.005;
  tgt.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,tgt.x));
  last={x:e.clientX,y:e.clientY};
});
document.addEventListener('mouseup',()=>drag=false);
renderer.domElement.addEventListener('wheel',e=>{
  camera.position.z+=e.deltaY*0.01;
  camera.position.z=Math.max(8,Math.min(20,camera.position.z));
});

// Tooltip
const raycaster=new THREE.Raycaster(),mouse=new THREE.Vector2();
renderer.domElement.addEventListener('mousemove',e=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const zoneInter=raycaster.intersectObjects(markerGroup.children).filter(i=>i.object.visible);
  const cityInter=raycaster.intersectObjects(cityGroup.children).filter(i=>i.object.visible);
  const inter=[...zoneInter,...cityInter];
  if(inter.length){
    const d=inter[0].object.userData;
    tooltip.style.left=e.clientX+10+'px';
    tooltip.style.top=e.clientY-20+'px';
    tooltip.textContent=d.name;
    tooltip.style.opacity=1;
  }else tooltip.style.opacity=0;
});
renderer.domElement.addEventListener('mouseleave',()=>tooltip.style.opacity=0);

// initial visibility
zones.forEach((_,i)=>markerGroup.children[i].visible=true);
cities.forEach((_,i)=>cityGroup.children[i].visible=true);

camera.position.z=12;
function animate(){
  requestAnimationFrame(animate);
  rot.x+=(tgt.x-rot.x)*.05;
  rot.y+=(tgt.y-rot.y)*.05;
  earth.rotation.x=clouds.rotation.x=rot.x;
  earth.rotation.y=clouds.rotation.y=rot.y;
  markerGroup.rotation.x=markerGroup.rotation.y=rot.x;
  markerGroup.rotation.y=rot.y;
  cityGroup.rotation.x=cityGroup.rotation.y=rot.x;
  cityGroup.rotation.y=rot.y;
  if(!drag)tgt.y+=0.0003;
  clouds.rotation.y+=0.0002;
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
