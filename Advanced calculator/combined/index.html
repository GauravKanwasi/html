<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fast Calculator</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
    font-family: system-ui, -apple-system, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    padding: 20px;
}
.calculator {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
}
.display {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    text-align: right;
}
#result {
    font-size: 2rem;
    font-weight: bold;
    color: #2d3748;
    min-height: 48px;
    word-wrap: break-word;
}
#input {
    width: 100%;
    border: none;
    background: transparent;
    font-size: 1.1rem;
    color: #666;
    text-align: right;
    outline: none;
    margin-top: 5px;
}
.buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}
.btn {
    border: none;
    padding: 15px;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    background: #f7fafc;
    color: #2d3748;
}
.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.btn:active {
    transform: translateY(0);
}
.btn.operator {
    background: #4299e1;
    color: white;
}
.btn.equals {
    background: #48bb78;
    color: white;
}
.btn.clear {
    background: #f56565;
    color: white;
}
.btn.function {
    background: #ed8936;
    color: white;
    font-size: 1rem;
}
.quick-convert {
    margin-top: 15px;
    display: flex;
    gap: 10px;
}
.quick-convert input {
    flex: 1;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
}
.quick-convert button {
    background: #9f7aea;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
}
.history {
    margin-top: 15px;
    max-height: 150px;
    overflow-y: auto;
    background: #f8f9fa;
    border-radius: 10px;
    padding: 10px;
}
.history-item {
    padding: 8px;
    border-bottom: 1px solid #e2e8f0;
    cursor: pointer;
    font-size: 0.9rem;
}
.history-item:hover {
    background: #edf2f7;
}
</style>
</head>
<body>
    <div class="calculator">
        <div class="display">
            <div id="result">0</div>
            <input type="text" id="input" placeholder="Type expression or conversion..." autocomplete="off">
        </div>
        
        <div class="buttons">
            <button class="btn clear" onclick="clearAll()">C</button>
            <button class="btn function" onclick="backspace()">⌫</button>
            <button class="btn function" onclick="addToInput('%')">%</button>
            <button class="btn operator" onclick="addToInput('/')">/</button>
            
            <button class="btn" onclick="addToInput('7')">7</button>
            <button class="btn" onclick="addToInput('8')">8</button>
            <button class="btn" onclick="addToInput('9')">9</button>
            <button class="btn operator" onclick="addToInput('*')">×</button>
            
            <button class="btn" onclick="addToInput('4')">4</button>
            <button class="btn" onclick="addToInput('5')">5</button>
            <button class="btn" onclick="addToInput('6')">6</button>
            <button class="btn operator" onclick="addToInput('-')">-</button>
            
            <button class="btn" onclick="addToInput('1')">1</button>
            <button class="btn" onclick="addToInput('2')">2</button>
            <button class="btn" onclick="addToInput('3')">3</button>
            <button class="btn operator" onclick="addToInput('+')">+</button>
            
            <button class="btn function" onclick="addToInput('sin(')">sin</button>
            <button class="btn" onclick="addToInput('0')">0</button>
            <button class="btn" onclick="addToInput('.')">.</button>
            <button class="btn equals" onclick="calculate()">=</button>
        </div>
        
        <div class="quick-convert">
            <input type="text" id="convertInput" placeholder="10 km to m">
            <button onclick="convertUnits()">Convert</button>
        </div>
        
        <div class="history" id="history">
            <!-- History will appear here -->
        </div>
    </div>

<script>
let input = document.getElementById('input');
let result = document.getElementById('result');
let history = document.getElementById('history');
let calculationHistory = JSON.parse(localStorage.getItem('calcHistory') || '[]');

// Update history display
function updateHistory() {
    history.innerHTML = calculationHistory.slice(-5).map(item => 
        `<div class="history-item" onclick="useHistory('${item.expression}')">
            ${item.expression} = ${item.result}
        </div>`
    ).reverse().join('');
}

// Add to input field
function addToInput(value) {
    input.value += value;
    input.focus();
}

// Clear everything
function clearAll() {
    input.value = '';
    result.textContent = '0';
}

// Backspace
function backspace() {
    input.value = input.value.slice(0, -1);
}

// Calculate expression
function calculate() {
    try {
        let expression = input.value.trim();
        if (!expression) return;
        
        // Replace common math symbols
        expression = expression.replace(/×/g, '*').replace(/÷/g, '/');
        
        // Handle percentages
        expression = expression.replace(/(\d+)%/g, '($1/100)');
        
        // Handle exponents
        expression = expression.replace(/(\d+)\^(\d+)/g, 'Math.pow($1,$2)');
        
        // Handle functions
        expression = expression.replace(/sin\(/g, 'Math.sin(');
        expression = expression.replace(/cos\(/g, 'Math.cos(');
        expression = expression.replace(/tan\(/g, 'Math.tan(');
        expression = expression.replace(/sqrt\(/g, 'Math.sqrt(');
        expression = expression.replace(/pi/g, 'Math.PI');
        
        // Evaluate safely
        let answer = Function('"use strict"; return (' + expression + ')')();
        
        // Round to avoid floating point issues
        answer = Math.round(answer * 100000000) / 100000000;
        
        result.textContent = answer;
        
        // Save to history
        calculationHistory.push({
            expression: input.value,
            result: answer
        });
        
        // Keep only last 20 calculations
        if (calculationHistory.length > 20) {
            calculationHistory = calculationHistory.slice(-20);
        }
        
        localStorage.setItem('calcHistory', JSON.stringify(calculationHistory));
        updateHistory();
        
    } catch (error) {
        result.textContent = 'Error';
    }
}

// Convert units
function convertUnits() {
    let convertInput = document.getElementById('convertInput').value;
    let match = convertInput.match(/(\d+(?:\.\d+)?)\s*([a-zA-Z]+)\s+to\s+([a-zA-Z]+)/i);
    
    if (!match) {
        result.textContent = 'Format: 10 km to m';
        return;
    }
    
    let value = parseFloat(match[1]);
    let fromUnit = match[2].toLowerCase();
    let toUnit = match[3].toLowerCase();
    
    // Simple conversion factors
    const conversions = {
        // Length
        'm': 1, 'km': 1000, 'cm': 0.01, 'mm': 0.001,
        'in': 0.0254, 'ft': 0.3048, 'yd': 0.9144, 'mi': 1609.34,
        
        // Weight
        'g': 1, 'kg': 1000, 'mg': 0.001, 'lb': 453.592, 'oz': 28.3495,
        
        // Temperature (special cases)
        'c': 'c', 'f': 'f', 'k': 'k'
    };
    
    if (['c', 'f', 'k'].includes(fromUnit) && ['c', 'f', 'k'].includes(toUnit)) {
        // Temperature conversion
        let temp = convertTemperature(value, fromUnit, toUnit);
        result.textContent = `${value} ${fromUnit} = ${temp.toFixed(2)} ${toUnit}`;
    } else if (conversions[fromUnit] && conversions[toUnit]) {
        // Regular conversion
        let resultValue = value * conversions[fromUnit] / conversions[toUnit];
        result.textContent = `${value} ${fromUnit} = ${resultValue.toFixed(4)} ${toUnit}`;
    } else {
        result.textContent = 'Unsupported units';
    }
}

// Temperature conversion
function convertTemperature(value, from, to) {
    if (from === to) return value;
    
    // Convert to Celsius first
    let celsius = value;
    if (from === 'f') celsius = (value - 32) * 5/9;
    if (from === 'k') celsius = value - 273.15;
    
    // Convert from Celsius to target
    if (to === 'c') return celsius;
    if (to === 'f') return celsius * 9/5 + 32;
    if (to === 'k') return celsius + 273.15;
}

// Use history item
function useHistory(expression) {
    input.value = expression;
    calculate();
}

// Keyboard support
input.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        calculate();
    }
});

document.addEventListener('keydown', function(e) {
    // Number keys
    if (e.key >= '0' && e.key <= '9') {
        addToInput(e.key);
    }
    // Operators
    else if (['+', '-', '*', '/', '.', '(', ')'].includes(e.key)) {
        addToInput(e.key);
    }
    // Backspace
    else if (e.key === 'Backspace') {
        backspace();
        e.preventDefault();
    }
    // Escape to clear
    else if (e.key === 'Escape') {
        clearAll();
    }
});

// Initialize
updateHistory();
input.focus();
</script>
</body>
</html>
