<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Gemini Pro Scientific Calculator v6 (Advanced)</title>
    <style>
        :root {
            --bg-grad-start: #6a82fb; --bg-grad-end: #fc5c7d;
            --calc-bg: rgba(255, 255, 255, 0.97); --display-bg: #f8f9fa;
            --text-primary: #2d3748; --text-secondary: #6c757d; --btn-bg: #fdfdfd;
            --btn-shadow: 0 4px 10px rgba(0,0,0,0.06); --btn-hover-shadow: 0 7px 18px rgba(0,0,0,0.12);
            --operator-bg: #4299e1; --equals-bg: #48bb78; --clear-bg: #f56565;
            --function-bg: #ed8936; --memory-bg: #38b2ac; --btn-text-light: white;
            --focus-outline: #4299e1;
        }
        [data-theme="dark"] {
            --bg-grad-start: #232526; --bg-grad-end: #414345;
            --calc-bg: rgba(45, 55, 72, 0.97); --display-bg: #2d3748;
            --text-primary: #edf2f7; --text-secondary: #a0aec0; --btn-bg: #4a5568;
            --operator-bg: #2b6cb0; --equals-bg: #2f855a; --clear-bg: #c53030;
            --focus-outline: #63b3ed;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        body {
            background: linear-gradient(135deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            padding: 20px; -webkit-font-smoothing: antialiased;
        }
        .calculator {
            background: var(--calc-bg); border-radius: 20px; padding: 25px;
            backdrop-filter: blur(10px); box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            width: 100%; max-width: 480px;
        }
        .btn:focus-visible, select:focus-visible, input:focus-visible {
            outline: 3px solid var(--focus-outline); outline-offset: 2px; border-radius: 8px;
        }
        .display { background: var(--display-bg); border-radius: 12px; padding: 15px 20px; margin-bottom: 20px; text-align: right; }
        #result { font-size: 2.8rem; font-weight: bold; color: var(--text-primary); min-height: 60px; word-wrap: break-word; word-break: break-all; line-height: 1.2; }
        .buttons { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; }
        .btn {
            border: none; padding: 15px 10px; border-radius: 12px; font-size: 1.1rem;
            font-weight: 600; cursor: pointer; background: var(--btn-bg); color: var(--text-primary);
            box-shadow: var(--btn-shadow); user-select: none; position: relative; overflow: hidden;
            transition: transform 0.15s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.15s cubic-bezier(0.25, 0.8, 0.25, 1);
            will-change: transform, box-shadow;
        }
        .btn:hover { transform: translateY(-3px) scale(1.03); box-shadow: var(--btn-hover-shadow); }
        .btn:active { transform: translateY(-1px) scale(0.98); transition-duration: 0.05s; }
        .ripple { position: absolute; border-radius: 50%; background-color: rgba(0,0,0,0.1); transform: scale(0); animation: ripple-animation 0.6s linear; }
        [data-theme="dark"] .ripple { background-color: rgba(255,255,255,0.1); }
        @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } }
        .btn[data-action="operator"] { background: var(--operator-bg); color: var(--btn-text-light); }
        .btn[data-action="equals"] { background: var(--equals-bg); color: var(--btn-text-light); }
        .btn[data-action="clear"], .btn[data-action="backspace"] { background: var(--clear-bg); color: var(--btn-text-light); }
        .btn[data-action="function"] { background: var(--function-bg); color: var(--btn-text-light); }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
    </style>
</head>
<body data-theme="dark">

    <div class="calculator" role="application" aria-roledescription="scientific calculator">
        <div id="sr-announcer" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
        <header class="header" style="margin-bottom: 15px; padding: 0 10px; display:flex; justify-content:space-between; align-items:center;">
            <h1 style="font-size:1.2rem; color: var(--text-primary); font-weight:600;">Gemini Pro v6</h1>
        </header>
        
        <div role="region" aria-live="polite" class="display" aria-labelledby="display-label">
            <span id="display-label" class="sr-only">Calculator Display</span>
            <div id="expression" style="min-height: 24px; font-size: 1rem; color: var(--text-secondary); word-wrap: break-word; word-break: break-all;"></div>
            <div id="result">0</div>
        </div>

        <div class="buttons" role="grid" aria-label="Calculator Buttons">
            <button class="btn second-fn" id="secondFnBtn" aria-pressed="false" aria-label="Second function">2nd</button>
            <button class="btn" id="modeToggle" aria-pressed="false" aria-label="Toggle mode. Currently Degrees.">DEG</button>
            <button class="btn" data-action="clear" aria-label="Clear all">C</button>
            <button class="btn" data-action="backspace" aria-label="Backspace">⌫</button>
            <button class="btn" data-key="/" data-display="÷" data-action="operator" aria-label="Divide">÷</button>
            
            <button class="btn fn-toggle" data-key="Math.sinh(" data-key-alt="Math.asinh(" data-display="sinh" data-display-alt="sinh⁻¹" data-action="function" aria-label="Hyperbolic Sine" data-aria-label-alt="Inverse Hyperbolic Sine">sinh</button>
            <button class="btn fn-toggle" data-key="Math.cosh(" data-key-alt="Math.acosh(" data-display="cosh" data-display-alt="cosh⁻¹" data-action="function" aria-label="Hyperbolic Cosine" data-aria-label-alt="Inverse Hyperbolic Cosine">cosh</button>
            <button class="btn fn-toggle" data-key="Math.tan(" data-key-alt="Math.atan(" data-display="tan" data-display-alt="tan⁻¹" data-action="function" aria-label="Tangent" data-aria-label-alt="Inverse Tangent">tan</button>
            <button class="btn" data-action="reciprocal" aria-label="Reciprocal">1/x</button>
            <button class="btn" data-key="*" data-display="×" data-action="operator" aria-label="Multiply">×</button>
            
            <button class="btn" data-key="**" data-display="^" data-action="operator" aria-label="Power">xʸ</button>
            <button class="btn" data-value="7" aria-label="Seven">7</button>
            <button class="btn" data-value="8" aria-label="Eight">8</button>
            <button class="btn" data-value="9" aria-label="Nine">9</button>
            <button class="btn" data-key="-" data-action="operator" aria-label="Subtract">-</button>

            <button class="btn" data-key="Math.sqrt(" data-display="√" data-action="function" aria-label="Square root">√</button>
            <button class="btn" data-value="4" aria-label="Four">4</button>
            <button class="btn" data-value="5" aria-label="Five">5</button>
            <button class="btn" data-value="6" aria-label="Six">6</button>
            <button class="btn" data-key="+" data-action="operator" aria-label="Add">+</button>

            <button class="btn" data-key="Math.log10(" data-display="log" data-action="function" aria-label="Logarithm base 10">log</button>
            <button class="btn" data-value="1" aria-label="One">1</button>
            <button class="btn" data-value="2" aria-label="Two">2</button>
            <button class="btn" data-value="3" aria-label="Three">3</button>
            <button class="btn" data-action="equals" style="grid-row: span 2;" aria-label="Equals">=</button>

            <button class="btn" data-key="Math.E" data-display="e" data-action="constant" aria-label="Euler's number">e</button>
            <button class="btn" data-action="sign" aria-label="Toggle Sign">+/-</button>
            <button class="btn" data-value="0" aria-label="Zero">0</button>
            <button class="btn" data-key="." data-action="decimal" aria-label="Decimal point">.</button>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- STATE & CONSTANTS ---
    let currentInput = '';
    let expressionForDisplay = '';
    let isRadianMode = false;
    let isSecondFunctionActive = false;
    const OPERATORS = ['+', '-', '*', '/', '**'];

    // --- DOM ELEMENTS ---
    const displayResult = document.getElementById('result');
    const displayExpression = document.getElementById('expression');
    const srAnnouncer = document.getElementById('sr-announcer');
    const secondFnBtn = document.getElementById('secondFnBtn');
    const modeToggle = document.getElementById('modeToggle');
    const fnToggleBtns = document.querySelectorAll('.fn-toggle');

    // --- HELPER FUNCTIONS ---
    const announce = (message) => {
        srAnnouncer.textContent = message;
        setTimeout(() => { srAnnouncer.textContent = ''; }, 100);
    };

    const createRipple = (event) => {
        const button = event.currentTarget;
        const ripple = document.createElement("span");
        const rect = button.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        ripple.style.width = ripple.style.height = `${size}px`;
        ripple.style.left = `${event.clientX - rect.left - size / 2}px`;
        ripple.style.top = `${event.clientY - rect.top - size / 2}px`;
        ripple.classList.add("ripple");
        button.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
    };

    const formatResult = (num) => {
        const numAbs = Math.abs(num);
        if (numAbs > 1e12 || (numAbs < 1e-6 && numAbs !== 0)) {
            return num.toExponential(6);
        }
        return String(parseFloat(num.toPrecision(12)));
    };
    
    // --- UI UPDATE FUNCTIONS ---
    const updateDisplay = () => {
        requestAnimationFrame(() => {
            const len = currentInput.length;
            displayResult.style.fontSize = len > 18 ? '1.5rem' : len > 12 ? '2rem' : '2.8rem';
            displayResult.textContent = currentInput || '0';
            displayExpression.textContent = expressionForDisplay || '\u00A0';
        });
    };

    // --- CORE LOGIC ---
    const handleCalculation = () => {
        if (!currentInput) return;
        try {
            if (/\/0(?!\.)/.test(currentInput)) throw new Error("Division by Zero");
            
            let expressionToEval = currentInput.replace(/π/g, 'Math.PI').replace(/e/g, 'Math.E');

            const trigMultiplier = isRadianMode ? '1' : '(Math.PI/180)';
            expressionToEval = expressionToEval.replace(/(Math\.(?:sin|cos|tan)h?)\(/g, (match, p1) => {
                if (p1.endsWith('h')) return match; // Hyperbolics don't use DEG/RAD
                return `${p1}(${trigMultiplier}*`;
            });
            
            const answer = new Function('"use strict"; return ' + expressionToEval)();
            
            if (isNaN(answer) || !isFinite(answer)) throw new Error("Invalid Expression");

            const formattedAnswer = formatResult(answer);
            expressionForDisplay += ' =';
            currentInput = formattedAnswer;
            announce(`Result is ${formattedAnswer}`);
        } catch (error) {
            expressionForDisplay = error.message;
            currentInput = '';
            announce(`Error: ${error.message}`);
        }
        updateDisplay();
    };

    const getLastNumberSegment = () => {
        const match = currentInput.match(/(-?\d*\.?\d+(?:e[+-]?\d+)?)$/);
        return match ? { value: match[0], index: match.index } : null;
    };

    const processInput = (target) => {
        if (!target) return;
        let { key, value, display, action } = target.dataset;
        action = action || (value ? 'number' : (key ? 'special' : 'none'));
        display = display || value || key;

        if (isSecondFunctionActive && target.dataset.keyAlt) {
            key = target.dataset.keyAlt;
            display = target.dataset.displayAlt;
        }

        if (expressionForDisplay.includes('=')) {
            expressionForDisplay = OPERATORS.includes(key) ? currentInput : '';
            currentInput = OPERATORS.includes(key) ? currentInput : '';
        }

        switch(action) {
            case 'clear': currentInput = ''; expressionForDisplay = ''; break;
            case 'backspace': currentInput = currentInput.slice(0, -1); expressionForDisplay = expressionForDisplay.slice(0, -1); break;
            case 'equals': handleCalculation(); return;
            case 'number': currentInput += value; expressionForDisplay += display; break;
            case 'decimal':
                if (!getLastNumberSegment()?.value.includes('.')) {
                    currentInput += key; expressionForDisplay += display;
                }
                break;
            case 'operator':
                if (currentInput || key === '-') {
                    if (OPERATORS.some(op => currentInput.endsWith(op))) {
                        currentInput = currentInput.slice(0, -1) + key;
                        expressionForDisplay = expressionForDisplay.slice(0, -1) + display;
                    } else { currentInput += key; expressionForDisplay += display; }
                }
                break;
            case 'sign': {
                const lastNum = getLastNumberSegment();
                if (lastNum) {
                    if (lastNum.value.startsWith('-')) {
                        currentInput = currentInput.substring(0, lastNum.index) + lastNum.value.substring(1);
                        expressionForDisplay = expressionForDisplay.substring(0, lastNum.index) + lastNum.value.substring(1);
                    } else {
                        currentInput = currentInput.substring(0, lastNum.index) + `(-${lastNum.value})`;
                        expressionForDisplay = expressionForDisplay.substring(0, lastNum.index) + `(-${lastNum.value})`;
                    }
                }
                break;
            }
            case 'reciprocal': {
                const lastNum = getLastNumberSegment();
                if(lastNum) {
                    const reciprocal = `(1/${lastNum.value})`;
                    currentInput = currentInput.substring(0, lastNum.index) + reciprocal;
                    expressionForDisplay = expressionForDisplay.substring(0, lastNum.index) + `1/(${lastNum.value})`;
                }
                break;
            }
            default: // functions, constants
                const isNum = !isNaN(parseInt(currentInput.slice(-1)));
                if(isNum && key && !OPERATORS.some(op => key.startsWith(op))) {
                    currentInput += '*';
                    expressionForDisplay += '×';
                }
                currentInput += key;
                expressionForDisplay += display;
                break;
        }
        updateDisplay();
    };

    // --- EVENT LISTENERS ---
    document.querySelectorAll('.btn').forEach(button => {
        button.addEventListener('click', (e) => {
            createRipple(e);
            processInput(e.currentTarget);
        });
    });

    secondFnBtn.addEventListener('click', () => {
        isSecondFunctionActive = !isSecondFunctionActive;
        secondFnBtn.setAttribute('aria-pressed', isSecondFunctionActive);
        secondFnBtn.classList.toggle('active', isSecondFunctionActive);
        fnToggleBtns.forEach(btn => {
            const originalLabel = btn.getAttribute('aria-label');
            const altLabel = btn.dataset.ariaLabelAlt;
            btn.setAttribute('aria-label', isSecondFunctionActive ? altLabel : originalLabel);
            btn.dataset.ariaLabelAlt = originalLabel;
            btn.innerHTML = isSecondFunctionActive ? btn.dataset.displayAlt : btn.dataset.display;
        });
        announce(`Second function ${isSecondFunctionActive ? 'activated' : 'deactivated'}`);
    });

    modeToggle.addEventListener('click', () => {
        isRadianMode = !isRadianMode;
        modeToggle.setAttribute('aria-pressed', isRadianMode);
        modeToggle.textContent = isRadianMode ? 'RAD' : 'DEG';
        const newMode = isRadianMode ? 'Radians' : 'Degrees';
        modeToggle.setAttribute('aria-label', `Toggle mode. Currently ${newMode}.`);
        announce(`${newMode} mode activated`);
    });

    // --- INITIALIZATION ---
    updateDisplay();
});
</script>
</body>
</html>